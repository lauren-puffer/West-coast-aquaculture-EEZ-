---
title: "EEZs for Aquaculture on the West Coast"
author: "Lauren Puffer"
date: "2025-11-25"
format: html
editor: visual
embed-resources: true
page-loading: false
code-fold: show
execute: 
  warning: false
  message: false
toc: TRUE
theme: journal
---

# Introduction

# Data citations

Froese, R., & Pauly, D. (Eds.). (n.d.). *Panulirus interruptus* (Randall, 1840). SeaLifeBase. <https://www.sealifebase.ca/summary/Panulirus-interruptus.html>

GEBCO Compilation Group. (2025). *GEBCO 2025 grid* \[Data set\]. General Bathymetric Chart of the Oceans. <https://www.gebco.net/data-products/gridded-bathymetry-data>

Flanders Marine Institute. (n.d.). *EEZ boundaries* \[Data set\]. Marine Regions. <https://www.marineregions.org/eez.php>

Gentry, R. R., Froehlich, H. E., Grimm, D., Kareiva, P., Parke, M., Rust, M., Gaines, S. D., & Halpern, B. S. (2017). Mapping the global potential for marine aquaculture. *Nature Ecology & Evolution*, *1*(9), 1317–1324. <https://doi.org/10.1038/s41559-017-0257-9>

Venter, L., Booth, A. J., & Merwe, M. V. D. (2008). The effect of temperature on the growth, survival and food consumption of the east coast rock lobster *Panulirus homarus rubellus*. *Aquaculture*, *280*(1–4), 227–231. <https://doi.org/10.1016/j.aquaculture.2008.05.002>

# Load libraries

```{r}
library(tidyverse)
library(sf)
library(terra)
library(tmap)
library(patchwork)
library(here)
library(dplyr)
```

# Load data

The files we will be loading are mostly raster (annual sea surface temperature and bathymetry) and a shapefile with the boundaries of Exclusive Economic Zones.

```{r}
#| message: false
#| warning: false

# Read in shapefile of EEZs
eez <- st_read(here("data", "wc_regions_clean.shp"))
```

## Sea surface temperature

The following files contain mean sea surface temperature across 5 different years from 2008 to 2012. These temperatures will be averaged later on in the analysis after stacking all 5 rasters.

```{r}
#| message: false
#| warning: false

# Read in rasters of sea surface temerpature
sst_2008 <- rast(here("data", "average_annual_sst_2008.tif"))
sst_2009 <- rast(here("data", "average_annual_sst_2009.tif"))
sst_2010 <- rast(here("data", "average_annual_sst_2010.tif"))
sst_2011 <- rast(here("data", "average_annual_sst_2011.tif"))
sst_2012 <- rast(here("data", "average_annual_sst_2012.tif"))
```

## Bathymetry

This raster conatins a grid profile of depths in the ocean. This will be important for selecting suitable area, given that most marine species have a depth range that they can live at.

```{r}
#| message: false
#| warning: false

# read in raster for depth
bath <- rast(here("data", "depth.tif"))
```

# Oysters

To test that our analysis works, we will first perform our entire workflow for the depth and sea surface temperature range of oysters. Oysters have a temperature range of 11-30°C and a depth range of 0-70 meters below sea level. We will use these ranges to create a matrix and keep only pixels that fall within these values.

## Stack rasters

Since all of our sea surface temperatures are across a time span of 5 years, we will have to stack the rasters and then get average values across the 5 years.

```{r}
# Use c() to stack
sst_stack <- c(sst_2008, 
              sst_2009, 
              sst_2010,
              sst_2011, 
              sst_2012)
```

## Calculate mean SST per cell

Our grid cells are all in Kelvin and we need them to be in Celsius. After calculating the mean, we will subtract 273.15 from every grid.

```{r}
# Get the mean of each of the cell values
sst_mean <- mean(sst_stack)

# Globally subtract 273.15
sst_c_mean <- sst_mean - 273.15   # subtract 273.15 from every cell
```

## Reproject bathymetry

Because bathymetry is not the same CRS as the sea surface temperature, we need to make sure that bathymetry is reprojected to match the mean sea surface temperature raster.

```{r}
#| message: false
#| warning: false

# Check that bathymetry and SST are the same CRS
crs(bath) == crs(sst_c_mean) # False!

# Reproject to SST crs
bath_reproj <- project(bath, crs(sst_c_mean))

# Check that the rasters match
crs(bath_reproj) == crs(sst_c_mean)
```

## Resample bathymetry data

Now, we have to resample the bathymetry raster to match the resolution of the sea surface temperature raster. So that we can determine where suitable habitat overlaps.

```{r}
#| message: false
#| warning: false

# Resample to SST
bath_aligned <- resample(bath_reproj, sst_c_mean)

# Check the extent
ext(bath_aligned) == ext(sst_c_mean)

# Check the resolution
res(bath_aligned) == res(sst_2008)
```

We will bring in the species information by creating matrices of both the sea surface temperature threshold and depth range of oysters.

```{r}
# Matrix of SST rang
sst_osyter_matrix <- matrix(c(
  -Inf, 11, 0,
  11, 30, 1,
  30, Inf, 0),
ncol = 3,
byrow = TRUE)
  
# Matrix of depth range
depth_oyster_matrix <- matrix(c(
  -Inf, -70, 0,
  -70, 0, 1,
  0, Inf, 0),
  ncol = 3,
  byrow = TRUE
)
```

Now that we have matrices, we can reclassify the sea surface temperature and bathymetry raster data using the matrices.

```{r}
# Reclassify
sst_reclassify <- classify(sst_c_mean, sst_osyter_matrix)
bath_reclassify <- classify(bath_aligned, depth_oyster_matrix)
```

We need to multiply these two reclissified ratsers in order to identify the areas of suitable habitat for the species. This is because the grid cells with suitable depth and temperature are identified with a 1, and those that are not are identified with a 0. If we multiply these rasters, then we only keep the areas where suitable depth and temperature overlap.

```{r}
#| message: false
#| warning: false

# Multiply the reclassified rasters by eachother
multiplied <- sst_reclassify * bath_reclassify

# Change multiplied raster 0's to NAs
multiplied[multiplied == 0 ] <- NA

# Plot suitable cells
plot(multiplied)
```

## Tranform EEZs to match SST CRS

We want to only include suitable cells that are contained in EEZs. We must ensure that the CRSs match before we perform and analysis with the EEZ shapefile and the multiplied raster.

```{r}
#| message: false
#| warning: false

# Reproject EEZ to SST
eez_proj <- st_transform(eez, crs(multiplied))

# Check the CRS
crs(multiplied) == crs(eez_proj)
```

## Crop suitable cells to EEZ

The multiplied raster of suitable areas must be cropped to the boundary of the EEZs to identify areas within each EEZ that contain suitable habitat.

```{r}
#| message: false
#| warning: false

# Crop suitable cells to EEZ
multiplied_crop <- crop(multiplied, eez_proj)

# Plot the cropped 
plot(multiplied_crop)
```

## Calculate zonal statistics

The zonal statistics of the cropped suitable area must be calculated to get the total area of suitable cells in each EEZ. We will use the cellSize() function to calculate the cell size of each grid cell in kilometers

```{r}
# Compue the area covered by each raster cell in km2
multiplied_crop_area <- cellSize(multiplied_crop, mask = TRUE, unit = "km")

# Rasterize the EEZ
eez_rast <- rasterize(eez_proj, multiplied_crop, field = "area_km2")

# Calculate zonal statistics of cropped raster with EEZ raster
suitable_zonal <- zonal(multiplied_crop_area,eez_rast, fun = "sum", 
                        na.rm = TRUE) # remove NAs

# Use cbin to bring in
zones_bind <- cbind(eez_proj, suitable_zonal)

# Keep only the useful columns
zones_clean <- zones_bind |>
  select(rgn, area_km2, area_km2.1) |>
  rename(region = rgn, 
         total_area = area_km2, 
         area_suitable = area_km2.1)
```

## Map of suitable area per EEZ

The goal of this visualization is to see how much suitable area in km2 for each Exclusive Economic Zone. We will create this map using the tmap package.

```{r}
#| message: false
#| warning: false

# Make a map of suitable area within Economic Zones
tm_shape(zones_clean)+
  tm_graticules()+
  tm_polygons(fill = "area_suitable")
```

# Function from suitable area workflow

We must repeat the process above in a generalizable function in order to be able to pass any species information through and get the same result.

To break down the process, our code needs to...

Take the inputs of 1) a raster with mean SST, 2) a raster of depth, 3) a shapefile, 4) max and min sst, 5) max and min sea surface temperature, and 5) species name.

With these data, the function must:

1.  Ensure that all CRSs are the same for EEZ, SST, and depth.
2.  Subtract 273.15 from the mean values of SST
3.  Crop depth to the extent of SST.
4.  Create matrix of max and min for SST and depth
5.  Apply matrix to SST and depth raster
6.  Multiply SST and depth suitable area rasters
7.  Crop suitable area raster to EEZ.
8.  Calculate zonal statistics for each EEZ based on suitable area.
9.  Make map of suitable area in each zone as a color gradient.

## EEZ Suitable area function

```{r}
# Mean SST pre calculated and 273.15 subtracted if in Kelvin
eez_suitable_area <- function(mean_sst, bath, eez, min_sst, max_sst, min_depth, max_depth, species_name){
  
  # Reproject EEZ to match the CRS of SST
  eez_reproj <- st_transform(eez, crs(mean_sst))
  
  # Reproject bathymetry to match the CRS of SST
  bath_reproj <- project(bath, mean_sst)
  
  # Crop bathymetry to match the extent of the SST raster
  bath_crop <- crop(bath_reproj, mean_sst)
  
  # Ensure that resolutions match
  sst_reproj <- resample(bath_crop, mean_sst, method = "near")
  
  
  # Build a raster for suitable temperature
  # SST matrix
  sst_matrix <- matrix(c(-Inf,min_sst, 0,
                         min_sst, max_sst, 1, 
                         max_sst, Inf, 0),
                       ncol = 3, byrow = TRUE)
  
  # Depth matrix
  depth_matrix <- matrix(c(-Inf, max_depth, 0, 
                           max_depth, min_depth, 1, 
                           min_depth, Inf, 0),
                         ncol = 3, byrow = TRUE)
  
  
  # Apply matrices to both rasters
  sst_reclassified <- classify(sst_reproj, rcl = sst_matrix)
  depth_reclassified <- classify(bath_reproj, rcl = depth_matrix)
  
  
  # Multiply both cells to get the suitable cells
  suitable_cells <- sst_reclassified * depth_reclassified
  
  
  # Convert 0s to NAs
  suitable_cells[suitable_cells == 0] <- NA
  
  
  # Crop suitable cells to EEZ
  suitable_cells_crop <- crop(suitable_cells, eez_reproj)
  
  
  # Make an EEZ raster
  eez_raster <- rasterize(eez_reproj, suitable_cells_crop, field = "area_km2")
  
  
  # Get the cell size from the suitable_area_crop raster
  suitable_cells_area <- cellSize(suitable_cells_crop,
                                  mask = TRUE, 
                                  lyrs = FALSE, 
                                  unit = "km"
                                  )
  
  
  # Conduct zonal statistics using the area of suitable cells
  zonal_suitable_cells <- zonal(suitable_cells_area, 
                                eez_raster,
                                  fun = "sum", 
                                  na.rm = TRUE)
  
  
  # Create a dataframe 
  suitable_area_df <- cbind(eez, zonal_suitable_cells) |>
    select(rgn, area_km2, area_km2.1) |>
    rename(region = rgn, 
         total_area = area_km2, 
         suitable_area = area_km2.1)
  
  # Create tmap from dataframe
  map_of_suitable_area <- tm_shape(suitable_area_df) +
  tm_graticules() +
  tm_polygons(
    fill = "suitable_area",
    fill.legend = tm_legend(
      title = "Suitable Area (km²)",
      position = tm_pos_out("right")
    )
  ) +
  tm_title(paste("Area of suitable habitat for", species_name))

  
  # Call the map 
  map_of_suitable_area
  
}
```

Now we want to test this workflow for Oysters.

```{r}
# Pass the oyster information through the function
# function(mean_sst, bath, eez, min_sst, max_sst, min_depth, max_depth, species_name
eez_suitable_area(mean_sst = sst_c_mean, bath = bath, eez = eez,
                  min_sst = 11, 
                  max_sst = 30, 
                  min_depth = 0, 
                  max_depth = -70, 
                  species_name = "Oyster")
```

# ![](data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==)P.interruptus (California spiny lobster)

Next, we will repeat this entire process for the California spiny lobster.

The California spiny lobster has an SST range between 10 to 21 Celsius and a depth range of 0 to 150 meters. We will use this information with our function to generate a map of suitable area for California spiny lobsters.

```{r}
# Plug California spiny lobsert information into 
eez_suitable_area(mean_sst = sst_c_mean, bath = bath, eez = eez, 
                  min_sst = 10, 
                  max_sst = 21, 
                  min_depth = 0, 
                  max_depth = -150, 
                  species_name = "California spiny lobster")
```

# Reflection

Unsurprisingly, the range of suitable area in each EEZ is the same. While lobsters have less range in their temperature threshold, they can live much deeper than oysters. It seems that the Washington and Southern California EEZs are the most optimal for spiny lobsters and oysters. While not much is know about the domestication and propagation of the spiny lobster, the success of the oyster in aquaculture operations is researched throughout the West coast (NOAA Fisheries, n.d.). In the Pacific Northwest for example, the shellfish industry generates \$270 million annually. Spiny lobster aquaculture has been successful in Vietnam, New Zealand, and Australia (Kolbert, 2015). Further research could investigate the methods for cultivating spiny lobster aquaculture, and the ultimate economic benefit of a such an operation.

## References

Kolbert, J. (2015, April 2). Salmon and lobster aquaculture. *Bates College Biology Department*. <https://www.bates.edu/biology/2015/04/02/salmon-and-lobster-aquaculture/>

NOAA Fisheries. (n.d.). *Commercial shellfish aquaculture on the West Coast*. <https://www.fisheries.noaa.gov/west-coast/aquaculture/commercial-shellfish-aquaculture-west-coast>
